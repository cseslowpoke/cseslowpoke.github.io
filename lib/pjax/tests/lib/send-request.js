"use strict";function _typeof(e){function t(e){return n.apply(this,arguments)}var n,s;function r(e){return s.apply(this,arguments)}return(_typeof="function"==typeof Symbol&&"symbol"===_typeof(Symbol.iterator)?(s=function(e){return void 0===e?"undefined":_typeof(e)},r.toString=function(){return s.toString()},r):(n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},t.toString=function(){return n.toString()},t))(e)}var nativeOpen,tape=require("tape"),sendRequest=require("../../lib/send-request.js");"responseURL"in XMLHttpRequest.prototype||(nativeOpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,t){return this.responseURL=t,nativeOpen.apply(this,arguments)}),tape("test xhr request",function(e){var s="https://httpbin.org/get";e.test("- request is made, gets a result, and is cache-busted",function(t){var n=sendRequest(s,{cacheBust:!0},function(e){t.equal(n.responseURL.indexOf("?"),s.length,"XHR URL is cache-busted when configured to be");try{e=JSON.parse(e)}catch(e){t.fail("xhr doesn't get a JSON response")}t.same(void 0===e?"undefined":_typeof(e),"object","xhr request get a result"),t.end()})}),e.test("- request is not cache-busted when configured not to be",function(e){var t=sendRequest(s,{},function(){e.equal(t.responseURL,s,"XHR URL is left untouched"),e.end()})}),e.end()}),tape("request headers are sent properly",function(t){sendRequest("https://httpbin.org/headers",{selectors:["div.pjax","div.container"]},function(e){e=JSON.parse(e).headers;t.equals(e["X-Requested-With"],"XMLHttpRequest","X-Requested-With header is set correctly"),t.equals(e["X-Pjax"],"true","X-PJAX header is set correctly"),t.equals(e["X-Pjax-Selectors"],'["div.pjax","div.container"]',"X-PJAX-Selectors header is set correctly"),t.end()})}),tape("HTTP status codes other than 200 are handled properly",function(n){sendRequest("https://httpbin.org/status/400",{},function(e,t){n.equals(e,null,"responseText is null"),n.equals(t.status,400,"HTTP status code is correct"),n.end()})}),tape.skip("XHR error is handled properly",function(t){sendRequest("https://encrypted.google.com/foobar",{},function(e){t.equals(e,null,"responseText is null"),t.end()})}),tape("POST body data is sent properly",function(t){var n=[{name:"test",value:"1"}];sendRequest("https://httpbin.org/post",{requestOptions:{requestMethod:"POST",requestParams:n}},function(e){e=JSON.parse(e);t.same(e.form[n[0].name],n[0].value,"requestParams were sent properly"),t.equals(e.headers["Content-Type"],"application/x-www-form-urlencoded","Content-Type header was set properly"),t.end()})}),tape("GET query data is sent properly",function(t){var n=[{name:"test",value:"1"}];sendRequest("https://httpbin.org/get",{requestOptions:{requestParams:n}},function(e){e=JSON.parse(e);t.same(e.args[n[0].name],n[0].value,"requestParams were sent properly"),t.end()})}),tape("XHR timeout is handled properly",function(t){sendRequest("https://httpbin.org/delay/5",{timeout:1e3},function(e){t.equals(e,null,"responseText is null"),t.end()})});